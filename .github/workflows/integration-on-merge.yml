name: Integration Tests on Merge

on:
  push:
    branches: [main]

jobs:
  trigger-integration-tests:
    name: Trigger Integration Tests
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Integration Tests (includes Playwright)
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            // Trigger integration tests (now includes Playwright automatically)
            const result = await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'manual-integration-tests.yml',
              ref: 'main',
              inputs: {
                test_suite: 'integration',  // Now includes both integration + Playwright
                test_pattern: '',
                max_cost_dollars: '0.00',
                send_slack_notification: 'false'
              }
            });
            
            console.log('Triggered integration + Playwright tests workflow');
            
            // Add summary
            await core.summary
              .addHeading('ðŸ”„ Post-Merge Tests Triggered')
              .addTable([
                [{data: 'Commit', header: true}, {data: '${{ github.sha }}'}],
                [{data: 'Author', header: true}, {data: '${{ github.actor }}'}],
                [{data: 'Test Suite', header: true}, {data: 'Integration + Playwright'}],
                [{data: 'Estimated Time', header: true}, {data: '~3 minutes'}]
              ])
              .addRaw(`\n[View running workflow](${context.serverUrl}/${context.repo.owner}/${context.repo.repo}/actions)`)
              .write();